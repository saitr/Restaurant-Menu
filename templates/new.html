<!DOCTYPE html>
<html>
<head>
    <title>Verify OTP</title>
</head>
<body>
    <h2>Verify OTP</h2>
    <form id="otpForm">
        {% csrf_token %}
        <label for="otp">Enter OTP:</label>
        <input type="text" name="otp" id="otp" required><br>
        <input type="hidden" name="phone_number" id="phone_number" value="{{ phone_number }}">
        <input type="submit" value="Verify">
    </form>

    <script>
        // Handle form submission
        document.getElementById('otpForm').addEventListener('submit', (event) => {
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);

            // Create a new XMLHttpRequest object
            const xhr = new XMLHttpRequest();

            // Define the function to handle the response
            xhr.onload = function() {
                if (xhr.status >= 200 && xhr.status < 400) {
                    const response = JSON.parse(xhr.responseText);
                    if (response.success) {
                        // Successful response
                        console.log('OTP verification successful');
                        window.location.href = '/home'; // Redirect to the home screen
                    } else {
                        // Failed response
                        console.log('OTP verification failed');
                        // Handle the error and display appropriate message
                    }
                } else {
                    // Error response
                    console.log('OTP verification failed');
                    // Handle the error and display appropriate message
                }
            };

            // Define the function to handle errors
            xhr.onerror = function() {
                console.error('Error:', xhr.statusText);
            };

            // Make POST request to verify_api with the form data
            xhr.open('POST', '/user_api/');
            xhr.send(formData);
        });
    </script>
</body>
</html>
